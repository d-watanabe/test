{"name":"Test　Twilio_Zabbix","tagline":"Test　Use Twilio in Zabbix","body":"# 概要\r\n***\r\ncall-request.phpに引数として、\"グループ名\"、\"ホスト名\"、\"トリガー名\"を渡すと、twilio_call関数を実行し、Twilioが連絡先に電話を掛ける。  \r\n電話はtwilio_zabbix.phpに設定したパラメータを元に、連絡先に順番に電話を掛ける。  \r\nユーザが応答すると、設定されたメッセージを流して通話を切断する。  \r\n\r\n## 使用するファイル\r\n|ファイル名|説明|\r\n|---|---|\r\n|call-request.php|パラメータのチェックとtwilio_call関数（コール処理を実行する関数）へ引数を渡す処理を行う|\r\n|call-function.php|コール処理とログ出力処理を行う関数が定義されている|\r\n|twilio_zabbix.php|必要なパラメータを設定|\r\n|calllog.log|ログ出力先ファイル。ログの出力形式については、表下に記載する。|\r\n|Serviceディレクトリ|Twilio PHP libraryのディレクトリ|\r\n> \r\nログ形式：  \r\n日時は、\"yyyy/mm/dd hh:mm:ss\"の書式で出力する。  \r\n・エラーの場合  \r\n発生日時 エラー内容  \r\n・Twilioのコール結果  \r\n発生日時 グループ名 FROM TO コール開始時間 コール終了時間 コールリトライ回数 コールステータス sleep_time call-request.phpが受け取った引数の数  \r\n> \r\n\r\n## ファイル設置場所\r\n|設置場所|ファイル名|\r\n|---|---|\r\n|/var/www/html/rest/|call-request.php、call-function.php、Serviceディレクトリ|\r\n|/var/lib/zabbix/|twilio_zabbix.php|\r\n|/var/log/zabbix/|calllog.log|\r\n\r\n## パラメータ説明\r\ntwilio_zabbix.phpは、call-request.phpにて使用するパラメータを設定しているファイル。  \r\nパラメータを変更することで、連絡先電話番号や流すメッセージを設定する。\r\n\r\n|パラメータ名|説明|\r\n|---|---|\r\n|$ACCOUNT_SID|TwilioアカウントのACCOUNT SIDを設定|\r\n|$AUTH_TOKEN|TwilioアカウントのAUTH_TOKENを設定|\r\n|$FROM_NUMBER|コールするTwilioの電話番号|\r\n|$CALL_GROUP_ARRAY|グループ名毎に'REPEAT'に設定した回数だけ通話スクリーニングを実施する。 コール先は、'NUMBER_LIST'に設定した番号である。例を表下に記載する。|\r\n|$CALL_TIME|何秒間コールするかを設定|\r\n|$SLEEP_TIME|電話の応答がなかった場合に次の電話番号にコールするまでの待機時間を設定（秒）|\r\n|$MESSAGE_REPEAT|$MESSAGESの内容を流す回数を設定|\r\n|$MESSAGES|電話応答があった場合に流すメッセージを設定。引数の値をメッセージに含めたい場合は、置き換える部分に$ARGV2$,$ARGV3$のように置き換え文字列を設定する。置き換え文字列は'$ARGVx$'の形式で、'x'の部分は1からの連番を設定し、メッセージの中で同じ番号は使用できない。|\r\n\r\n> 例）  \r\n$CALL_GROUP_ARRAY['group1']['REPEAT']='2';  \r\n$CALL_GROUP_ARRAY['group1']['NUMBER_LIST']='810123456789,811234567890';  \r\n$CALL_GROUP_ARRAY['group2']['REPEAT']='3';  \r\n$CALL_GROUP_ARRAY['group2']['NUMBER_LIST']='810123456789,811234567890';  \r\n> \r\n\r\n## 関数説明\r\ncall-function.phpには、以下の関数が定義されている。関数に渡している引数については、下の表を参照。\r\n\r\n|関数名|説明|\r\n|---|---|\r\n|twilio_call ($client, $GROUP_NAME, $CALL_COUNT, $FROM_NUMBER, $NUMBER_LIST_NUMBER, $twilioMessages, $CALL_TIME, $SLEEP_TIME, $ARGV_COUNT)|引数を元に、電話を掛ける処理を行う|\r\n|twilio_log ($client, $call, $GROUP_NAME, $CALL_COUNT, $SLEEP_TIME, $ARGV_COUNT)|電話を掛けた結果をログファイルに出力|\r\n|error_log_message($error_message)|ログファイルにエラー内容を書き込む|\r\n\r\n|引数名|説明|\r\n|---|---|\r\n|$client|TwilioのRESTクライアントをインスタンス化|\r\n|$GROUP_NAME|グループ名|\r\n|$CALL_COUNT|何順目のコール処理かのカウント|\r\n|$NUMBER_LIST_NUMBER|電話の宛先番号|\r\n|$twilioMessages|流すメッセージ内容|\r\n|$ARGV_COUNT|call-request.phpに渡された引数の数|\r\n|$call|コール処理のオブジェクト|\r\n\r\n## 動作確認環境\r\n* Zabbix 2.2.2\r\n* PHP 5.5.7\r\n\r\n## 実行方法\r\ncall-request.phpに引数として、\"グループ名\"、\"ホスト名\"、\"トリガー名\"を渡して実行する。\r\n```\r\n# php call-request.php \"group1\" \"host1\" \"trigger\"\r\n```\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}